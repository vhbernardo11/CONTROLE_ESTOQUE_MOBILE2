<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Almoxarifado Pro - Controle de Estoque</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .app { max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .container { padding: 30px; }
        .search-box { width: 100%; padding: 15px; font-size: 16px; border: 2px solid #667eea; border-radius: 10px; outline: none; transition: all 0.3s; margin-bottom: 20px; }
        .btn { padding: 12px 30px; border: none; border-radius: 10px; font-size: 16px; cursor: pointer; transition: all 0.3s; font-weight: bold; margin-right: 10px; margin-bottom: 10px; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-secondary { background: #6c757d; color: white; }
        table { width: 100%; border-collapse: collapse; background: white; margin-top: 20px; }
        thead { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #e9ecef; }
        tbody tr:hover { background: #f8f9fa; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; padding: 30px; border-radius: 20px; max-width: 500px; width: 90%; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-group input { width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 16px; }
        .btn-edit { background: #ffc107; color: #000; padding: 8px 15px; border: none; border-radius: 8px; cursor: pointer; margin-right: 5px; }
        .btn-delete { background: #dc3545; color: white; padding: 8px 15px; border: none; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>
    <div class="app">
        <div class="header">
            <h1>üè¢ Almoxarifado Pro</h1>
            <p>Sistema de Controle de Estoque</p>
        </div>
        <div class="container">
            <input type="text" id="searchInput" class="search-box" placeholder="üîç Pesquisar produto...">
            <div>
                <button class="btn btn-primary" onclick="openAddModal()">‚ûï Adicionar Produto</button>
                <button class="btn btn-success" onclick="exportToExcel()">üìä Exportar Excel</button>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>C√≥digo</th>
                        <th>Descri√ß√£o</th>
                        <th>Unidade</th>
                        <th>Quantidade</th>
                        <th>A√ß√µes</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>
    <div id="productModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">Adicionar Produto</h2>
            <form id="productForm">
                <div class="form-group"><label>C√≥digo:</label><input type="text" id="codigo" required></div>
                <div class="form-group"><label>Descri√ß√£o:</label><input type="text" id="descricao" required></div>
                <div class="form-group"><label>Unidade:</label><input type="text" id="unidade" required></div>
                <div class="form-group"><label>Quantidade:</label><input type="number" id="quantidade" required></div>
                <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                <button type="submit" class="btn btn-primary">Salvar</button>
            </form>
        </div>
    </div>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, remove, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        const firebaseConfig = {
            apiKey: "AIzaSyDFt8a4YBHNZBwZqWRJ7vKHhY_Nt0wE6xQ",
            authDomain: "almoxarifado-pro-2025.firebaseapp.com",
            databaseURL: "https://almoxarifado-pro-2025-default-rtdb.firebaseio.com",
            projectId: "almoxarifado-pro-2025",
            storageBucket: "almoxarifado-pro-2025.firebasestorage.app",
            messagingSenderId: "1014586952090",
            appId: "1:1014586952090:web:abc123"
        };
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        let currentEditId = null;
        let products = [];
        onValue(ref(database, 'products'), (snapshot) => {
            products = [];
            const data = snapshot.val();
            if (data) { Object.keys(data).forEach(key => { products.push({ id: key, ...data[key] }); }); }
            renderTable();
        });
        window.openAddModal = function() {
            currentEditId = null;
            document.getElementById('modalTitle').textContent = 'Adicionar Produto';
            document.getElementById('productForm').reset();
            document.getElementById('productModal').classList.add('active');
        };
        window.closeModal = function() {
            document.getElementById('productModal').classList.remove('active');
            currentEditId = null;
        };
        window.editProduct = function(id) {
            const product = products.find(p => p.id === id);
            if (product) {
                currentEditId = id;
                document.getElementById('modalTitle').textContent = 'Editar Produto';
                document.getElementById('codigo').value = product.codigo;
                document.getElementById('descricao').value = product.descricao;
                document.getElementById('unidade').value = product.unidade;
                document.getElementById('quantidade').value = product.quantidade;
                document.getElementById('productModal').classList.add('active');
            }
        };
        window.deleteProduct = async function(id) {
            if (confirm('Deseja realmente excluir este produto?')) { await remove(ref(database, 'products/' + id)); }
        };
        window.exportToExcel = function() {
            let csv = 'C√≥digo,Descri√ß√£o,Unidade,Quantidade\n';
            products.forEach(p => { csv += `${p.codigo},${p.descricao},${p.unidade},${p.quantidade}\n`; });
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url; a.download = 'estoque.csv'; a.click();
        };
        document.getElementById('productForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const product = {
                codigo: document.getElementById('codigo').value,
                descricao: document.getElementById('descricao').value,
                unidade: document.getElementById('unidade').value,
                quantidade: parseFloat(document.getElementById('quantidade').value)
            };
            const id = currentEditId || Date.now().toString();
            await set(ref(database, 'products/' + id), product);
            closeModal();

                // Event listener para o formul√°rio de produtos
    document.getElementById('productForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const product = {
            codigo: document.getElementById('codigo').value,
            descricao: document.getElementById('descricao').value,
            unidade: document.getElementById('unidade').value,
            quantidade: parseFloat(document.getElementById('quantidade').value)
        };
        
        if (currentEditId) {
            // Editar produto existente
            const index = produtos.findIndex(p => p.id === currentEditId);
            if (index !== -1) {
                produtos[index] = { ...produtos[index], ...product };
            }
        } else {
            // Adicionar novo produto
            product.id = Date.now().toString();
            produtos.push(product);
        }
        
        salvarDados();
        closeModal();
        exibirToast('‚úÖ Produto salvo com sucesso!');
    });
        });
        document.getElementById('searchInput').addEventListener('input', (e) => { renderTable(e.target.value); });
        function renderTable(searchTerm = '') {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';
            const filtered = products.filter(p => p.descricao.toLowerCase().includes(searchTerm.toLowerCase()) || p.codigo.toLowerCase().includes(searchTerm.toLowerCase()));
            filtered.forEach(product => {
                const row = tbody.insertRow();
                row.innerHTML = `<td>${product.codigo}</td><td>${product.descricao}</td><td>${product.unidade}</td><td>${product.quantidade}</td><td><button class="btn-edit" onclick="editProduct('${product.id}')">‚úèÔ∏è Editar</button><button class="btn-delete" onclick="deleteProduct('${product.id}')">üóëÔ∏è Excluir</button></td>`;
            });
        }
    </script>
</body>
</html>
